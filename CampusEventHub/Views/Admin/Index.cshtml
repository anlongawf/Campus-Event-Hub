@model IEnumerable<CampusEventHub.Models.Event>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Qu·∫£n l√Ω s·ª± ki·ªán</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
</head>
<body>
<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">üìÖ Qu·∫£n l√Ω s·ª± ki·ªán</h1>
        <a href="@Url.Action("CreateEvent", "Admin")" class="btn btn-primary">
            <i class="fa fa-plus"></i> T·∫°o s·ª± ki·ªán m·ªõi
        </a>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    @if (TempData["WarningMessage"] != null)
    {
        <div class="alert alert-warning">@TempData["WarningMessage"]</div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var evt in Model)
            {
                var availableCount = evt.Seats.Count(s => s.Status == CampusEventHub.Models.SeatStatus.Available);
                var bookedCount = evt.Seats.Count(s => s.Status == CampusEventHub.Models.SeatStatus.Booked);
                var reservedCount = evt.Seats.Count(s => s.Status == CampusEventHub.Models.SeatStatus.Reserved);
                var isPast = evt.EventDate < DateTime.Now;

                <div class="col-md-4">
                    <div class="card shadow-sm h-100">
                        @if (!string.IsNullOrEmpty(evt.ImageUrl))
                        {
                            <img src="@evt.ImageUrl" class="card-img-top" alt="@evt.EventName"
                                 onerror="this.src='https://via.placeholder.com/350x200?text=No+Image'" />
                        }
                        else
                        {
                            <img src="https://via.placeholder.com/350x200?text=No+Image" class="card-img-top" />
                        }

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                @evt.EventName
                                @if (isPast)
                                {
                                    <span class="badge bg-danger">ƒê√£ qua</span>
                                }
                                else if (availableCount == 0)
                                {
                                    <span class="badge bg-warning text-dark">H·∫øt ch·ªó</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">C√≤n ch·ªó</span>
                                }
                            </h5>

                            <p class="card-text mb-1"><i class="fa fa-calendar"></i> @evt.EventDate.ToString("dd/MM/yyyy HH:mm")</p>

                            @if (!string.IsNullOrEmpty(evt.Location))
                            {
                                <p class="card-text mb-1"><i class="fa fa-location-dot"></i> @evt.Location</p>
                            }

                            <p class="card-text mb-1"><i class="fa fa-star"></i> @evt.TrainningPoint ƒëi·ªÉm r√®n luy·ªán</p>

                            @if (!string.IsNullOrEmpty(evt.Description))
                            {
                                <!-- m√¥ t·∫£ r√∫t g·ªçn -->
                                <p id="desc-short" class="card-text">
                                    @(evt.Description.Length > 25
                                        ? evt.Description.Substring(0, 25) + "..."
                                        : evt.Description)
                                </p>
                            }
                            else
                            {
                                <p class="text-muted">Ch∆∞a c√≥ m√¥ t·∫£ cho s·ª± ki·ªán n√†y.</p>
                            }


                            <div class="mt-auto d-flex flex-wrap gap-2">
                                <a href="@Url.Action("EditEvent", "Admin", new { id = evt.EventId })"
                                   class="btn btn-warning btn-sm">
                                    <i class="fa fa-pen"></i> S·ª≠a
                                </a>

                                <a asp-action="Details" asp-controller="Event" asp-route-id="@evt.EventId"
                                   class="btn btn-outline-secondary btn-sm">
                                    <i class="fa fa-info-circle"></i> Chi ti·∫øt
                                </a>

                                <form asp-action="DeleteEvent" asp-controller="Admin" method="post"
                                      onsubmit="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·ª± ki·ªán n√†y?');">
                                    <input type="hidden" name="id" value="@evt.EventId" />
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        <i class="fa fa-trash"></i> X√≥a
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="card-footer bg-light">
                            <div class="d-flex justify-content-around text-center">
                                <div>
                                    <strong>@evt.Seats.Count</strong><br /><small>T·ªïng gh·∫ø</small>
                                </div>
                                <div>
                                    <strong class="text-success">@availableCount</strong><br /><small>C√≤n tr·ªëng</small>
                                </div>
                                <div>
                                    <strong class="text-primary">@bookedCount</strong><br /><small>ƒê√£ ƒë·∫∑t</small>
                                </div>
                                <div>
                                    <strong class="text-muted">@reservedCount</strong><br /><small>B·ªã kh√≥a</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <div class="fs-1">üìÖ</div>
            <h2>Ch∆∞a c√≥ s·ª± ki·ªán n√†o</h2>
            <p class="text-muted">H√£y t·∫°o s·ª± ki·ªán ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
            <a href="@Url.Action("CreateEvent", "Admin")" class="btn btn-primary mt-3">
                <i class="fa fa-plus"></i> T·∫°o s·ª± ki·ªán m·ªõi
            </a>
        </div>
    }
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
